name: Add PR to Project

on:
  workflow_dispatch:
  pull_request:
    types: [opened, edited, reopened]
    branches:
      - main
      - master

jobs:
  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - name: Add PR to Project
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.TOKEN }}
          script: |
            const pr = context.payload.pull_request;
            
            const projectData = await github.graphql(`
              query($org: String!, $number: Int!) {
                organization(login: $org) {
                  projectV2(number: $number) {
                    id
                  }
                }
              }
            `, {
              org: 'test-org-payal',
              number: 2
            });
            
            const projectId = projectData.organization.projectV2.id;
            
            try {
              await github.graphql(`
                mutation($projectId: ID!, $contentId: ID!) {
                  addProjectV2ItemById(input: {projectId: $projectId, contentId: $contentId}) {
                    item { id }
                  }
                }
              `, {
                projectId: projectId,
                contentId: pr.node_id
              });
              console.log('✅ PR added to project');
            } catch (e) {
              if (e.message.includes('already exists')) {
                console.log('ℹ️ PR already in project');
              } else {
                console.error('❌ Error:', e.message);
              }
            }
